<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Готель Хрещатик{% endblock %}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@300;400;600&family=Montserrat:wght@300;400;500&display=swap" rel="stylesheet">
</head>
<body>
    <header class="header">
        <div class="container">
            <div class="header-top">
                <div class="header-address">
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                        <path d="M8 0C4.69 0 2 2.69 2 6c0 4.5 6 10 6 10s6-5.5 6-10c0-3.31-2.69-6-6-6zm0 8c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2z" fill="#B8963E"/>
                    </svg>
                    <span id="headerAddress">м. Київ, Хрещатик, 5</span>
                </div>
                <div class="header-logo">
                    <a href="/">
                        <h1>Хрещатик</h1>
                    </a>
                </div>
                <div class="header-contacts">
                    <div class="contact-item">
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                            <path d="M3.5 1.5A2.5 2.5 0 011 4v8a2.5 2.5 0 002.5 2.5h9A2.5 2.5 0 0014.5 12V4a2.5 2.5 0 00-2.5-2.5h-9zM2 4a1.5 1.5 0 011.5-1.5h9A1.5 1.5 0 0114 4v.217l-5.928 4.428a.5.5 0 01-.594 0L2 4.217V4z" fill="#B8963E"/>
                        </svg>
                        <span id="headerPhone">+380 95 666 66 66</span>
                    </div>
                </div>
            </div>

            <nav class="nav">
                <ul class="nav-list">
                    <li class="nav-item"><a href="/rooms" class="nav-link">♦ НОМЕРИ</a></li>
                    <li class="nav-item dropdown">
                        <a href="/bookings" class="nav-link">♦ БРОНЮВАННЯ</a>
                        <ul class="dropdown-menu">
                            <li><a href="/bookings">♦ Переглянути бронювання</a></li>
                            <li><a href="/booking/create">♦ Створити бронювання</a></li>
                        </ul>
                    </li>
                    <li class="nav-item dropdown">
                        <a href="/reviews" class="nav-link">♦ ВІДГУКИ</a>
                        <ul class="dropdown-menu">
                            <li><a href="/reviews">♦ Переглянути відгуки</a></li>
                            <li class="auth-only" style="display: none;"><a href="/reviews/create">♦ Створити відгук</a></li>
                        </ul>
                    </li>
                    <li class="nav-item admin-only" style="display: none;">
                        <a href="/users" class="nav-link">♦ КОРИСТУВАЧІ</a>
                    </li>
                    <li class="nav-item"><a href="/contacts" class="nav-link">♦ КОНТАКТИ</a></li>
                </ul>
                <div class="header-auth">
                    <a href="/login" class="login-btn">Увійти</a>
                </div>
            </nav>
        </div>
    </header>

    <main class="main-content">
        {% block content %}{% endblock %}
    </main>

    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3 id="footerHotelName">Готель Хрещатик</h3>
                    <p id="footerAddress">м. Київ, Хрещатик, 5</p>
                </div>
                <div class="footer-section">
                    <h3>Контакти</h3>
                    <p>Телефон: <span id="footerPhone">+38 095 666 66 66</span></p>
                    <p>Email: <span id="footerEmail">info@hotel_chreshatyk.com</span></p>
                </div>
                <div class="footer-section">
                    <h3>Режим роботи</h3>
                    <p id="footerSchedule">Цілодобово</p>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 Готель Хрещатик. Всі права захищені.</p>
            </div>
        </div>
    </footer>
    
    <!-- Include authentication JavaScript -->
    <script src="{{ url_for('static', filename='js/auth.js') }}"></script>
    
    <script>
        // Завантаження контактної інформації для header та footer
        async function loadGlobalContactInfo() {
            try {
                const response = await fetch('/api/v1/contacts/');
                if (response.ok) {
                    const data = await response.json();
                    
                    // Оновлюємо header
                    const headerAddress = document.getElementById('headerAddress');
                    const headerPhone = document.getElementById('headerPhone');
                    if (headerAddress) headerAddress.textContent = data.address;
                    if (headerPhone) headerPhone.textContent = data.phone;
                    
                    // Оновлюємо footer
                    const footerHotelName = document.getElementById('footerHotelName');
                    const footerAddress = document.getElementById('footerAddress');
                    const footerPhone = document.getElementById('footerPhone');
                    const footerEmail = document.getElementById('footerEmail');
                    const footerSchedule = document.getElementById('footerSchedule');
                    
                    if (footerHotelName) footerHotelName.textContent = data.hotel_name;
                    if (footerAddress) footerAddress.textContent = data.address;
                    if (footerPhone) footerPhone.textContent = data.phone;
                    if (footerEmail) footerEmail.textContent = data.email;
                    if (footerSchedule) footerSchedule.textContent = data.schedule;
                    
                    console.log('Контакти оновлено:', data);
                }
            } catch (error) {
                console.error('Помилка завантаження контактів:', error);
            }
        }
        
        // Експортуємо функцію глобально (до DOMContentLoaded)
        window.reloadGlobalContacts = loadGlobalContactInfo;

        document.addEventListener('DOMContentLoaded', async () => {
            // Завантажуємо контактну інформацію
            loadGlobalContactInfo();
            
            try {
                // Перевіряємо, чи є токен
                const token = localStorage.getItem('access_token');
                if (!token) return;

                // Отримуємо інформацію про поточного користувача
                const response = await fetch('/api/v1/auth/me', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (response.ok) {
                    const user = await response.json();
                    
                    // Показуємо елементи для авторизованих користувачів
                    const authOnlyElements = document.querySelectorAll('.auth-only');
                    authOnlyElements.forEach(element => {
                        element.style.display = 'block';
                    });
                    
                    // Показуємо кнопку "Користувачі" тільки для адміністраторів
                    if (user.role === 'ADMIN') {
                        const adminLinks = document.querySelectorAll('.admin-only');
                        adminLinks.forEach(link => {
                            link.style.display = 'block';
                        });
                    }
                }
            } catch (error) {
                console.error('Помилка перевірки ролі:', error);
            }
        });
    </script>
</body>
</html>